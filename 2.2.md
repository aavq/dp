–û—Ç–ª–∏—á–Ω—ã–π –º–æ–º–µ–Ω—Ç, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞—Ç—å ¬´–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é¬ª –≤—Å–µ–≥–æ –≤–æ–∫—Ä—É–≥ Istio üòÑ
–ù–∏–∂–µ ‚Äî –Ω–∞–±–æ—Ä **read-only** –∫–æ–º–∞–Ω–¥ –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Å–æ–±—Ä–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ –∫–∞–∂–¥–æ–º—É –ø—É–Ω–∫—Ç—É `In-cluster dependencies`.

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ: —Ç–æ–ª—å–∫–æ `get`/`describe`/`api-resources`, –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è—é—Ç.

---

## 0. –û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

–ï—Å–ª–∏ —É —Ç–µ–±—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤ `kubeconfig`, —É–¥–æ–±–Ω–æ –≤—Å–µ–≥–¥–∞ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `--context`:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
kubectl config get-contexts

# –ü—Ä–∏–º–µ—Ä: –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å —Ç–µ–∫—É—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
CTX=your-cluster-context

# –ò –¥–∞–ª–µ–µ:
kubectl --context="$CTX" get ns
```

–ú–∏–Ω–∏-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–±–µ–≥–∞—Ç—å—Å—è –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º:

```bash
for CTX in $(kubectl config get-contexts -o name); do
  echo "===== Context: $CTX ====="
  kubectl --context="$CTX" get ns
done
```

–î–∞–ª—å—à–µ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å `--context="$CTX"`.

---

## 2.2.1.1 Kubernetes core components

### –í–µ—Ä—Å–∏–∏ API-—Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞

```bash
kubectl --context="$CTX" version --short
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ `kubectl` –∏ Kubernetes API-—Å–µ—Ä–≤–µ—Ä–∞. –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏—è–º–∏ Istio ‚Üî Kubernetes.

---

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–¥–∞—Ö

```bash
kubectl --context="$CTX" get nodes -o wide
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–æ–¥ —Å –∏—Ö —Ä–æ–ª—è–º–∏, –≤–µ—Ä—Å–∏—è–º–∏ kubelet/kube-proxy, –û–° –∏ —Ç.–¥. –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª:

```bash
kubectl --context="$CTX" get nodes -o wide > cluster-$CTX-nodes.txt
```

---

### –î–æ—Å—Ç—É–ø–Ω—ã–µ API –∏ CRDs

–ß—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ API –≤–æ–æ–±—â–µ –µ—Å—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:

```bash
# –í—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API-–≥—Ä—É–ø–ø—ã/—Ä–µ—Å—É—Ä—Å—ã
kubectl --context="$CTX" api-resources

# –í—Å–µ CRD
kubectl --context="$CTX" get crd
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∑–≤–æ–ª—è–µ—Ç —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (Gateway API, cert-manager, Gatekeeper, Kyverno –∏ —Ç.–ø.).

---

## 2.2.1.2 DNS: kube-dns / CoreDNS

### –ù–∞–π—Ç–∏ DNS-—Å–µ—Ä–≤–∏—Å –∏ Deployment

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ kube-system
kubectl --context="$CTX" get svc -n kube-system

# CoreDNS, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
kubectl --context="$CTX" get deploy,svc -n kube-system | grep -i 'coredns\|kube-dns'
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `coredns` –∏–ª–∏ `kube-dns`, –∏ –∫–∞–∫ –æ–Ω–∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã.

### –ó–∞–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CoreDNS

```bash
kubectl --context="$CTX" get configmap coredns -n kube-system -o yaml \
  > cluster-$CTX-coredns-config.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π `Corefile` –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS ‚Äî –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –¥–ª—è DR.

---

## 2.2.1.3 CNI plugin

–ó–∞–¥–∞—á–∞ ‚Äî –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π CNI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Å –∫–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

### –ù–∞–π—Ç–∏ CNI –ø–æ Pod/DaemonSet –≤ kube-system

```bash
kubectl --context="$CTX" get ds,pods -n kube-system -o wide \
  | egrep -i 'calico|cilium|flannel|weave|kube-router|antrea|canal'
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ò—â–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ CNI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã. –ü–æ –≤—ã–≤–æ–¥—É –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ CNI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (Calico, Cilium, Flannel –∏ —Ç.–ø.).

### –ï—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–æ–¥–∞–º (bare-metal)

–ù–∞ –Ω–æ–¥–µ –ø–æ–¥ `root`:

```bash
ls /etc/cni/net.d
cat /etc/cni/net.d/*.conf
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã CNI (—Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤, IPAM, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).
–≠—Ç–∏ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–æ –ª—É—á—à–µ –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö IP-–¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–≤–µ—Ç–∏—Ç—å).

---

## 2.2.1.4 Cert-manager / PKI

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ cert-manager

```bash
kubectl --context="$CTX" get ns
kubectl --context="$CTX" get pods -n cert-manager
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ `cert-manager` –∏ –∫–∞–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–≥—É—Ç (`cert-manager`, `cert-manager-webhook`, `cert-manager-cainjector` –∏ —Ç.–ø.).

### –°–ø–∏—Å–æ–∫ CRD cert-manager

```bash
kubectl --context="$CTX" get crd | grep cert-manager.io
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç, –∫–∞–∫–∏–µ CRD –¥–æ—Å—Ç—É–ø–Ω—ã (`certificates.cert-manager.io`, `clusterissuers.cert-manager.io` –∏ —Ç.–¥.).

### –ó–∞–±—Ä–∞—Ç—å Issuer/ClusterIssuer/Certificates

```bash
# ClusterIssuer (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ)
kubectl --context="$CTX" get clusterissuers.cert-manager.io -A -o yaml \
  > cluster-$CTX-certmanager-clusterissuers.yaml

# Issuer (namespaced)
kubectl --context="$CTX" get issuers.cert-manager.io -A -o yaml \
  > cluster-$CTX-certmanager-issuers.yaml

# Certificates (–º–æ–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ istio-d –∏ sm-gateways)
kubectl --context="$CTX" get certificates.cert-manager.io -A -o yaml \
  > cluster-$CTX-certmanager-certificates.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É PKI-–æ–±—ä–µ–∫—Ç–æ–≤, –µ—Å–ª–∏ Istio –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cert-manager –¥–ª—è –≤—ã–ø—É—Å–∫–æ–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è ingress-gateway).

---

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Istio CA / –∫–æ—Ä–Ω–µ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–î–ª—è Istio-CA (–±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ cert-manager):

```bash
# –ö–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ namespaces (–º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –∏–Ω–∞—á–µ)
kubectl --context="$CTX" get configmap -A | grep istio-ca-root-cert

# –ï—Å–ª–∏ –≤ istio-d –µ—Å—Ç—å Secret —Å –∫–æ—Ä–Ω–µ–º/–∫–ª—é—á–æ–º
kubectl --context="$CTX" get secret -n istio-d | grep -i 'istio-ca\|cacerts'
kubectl --context="$CTX" get secret cacerts -n istio-d -o yaml \
  > cluster-$CTX-istio-cacerts.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —É—Å—Ç—Ä–æ–µ–Ω trust-bundle Istio: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CA –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π.

---

## 2.2.1.5 Gateway API CRDs

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ Gateway API

```bash
kubectl --context="$CTX" get crd | grep gateway.networking.k8s.io
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –µ—Å—Ç—å –ª–∏ CRD —Ç–∏–ø–∞ `gateways.gateway.networking.k8s.io`, `httproutes.gateway.networking.k8s.io` –∏ —Ç.–ø.

### –°–æ–±—Ä–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã Gateway API (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

```bash
kubectl --context="$CTX" get gateways.gateway.networking.k8s.io -A -o yaml \
  > cluster-$CTX-gateways.yaml

kubectl --context="$CTX" get httproutes.gateway.networking.k8s.io -A -o yaml \
  > cluster-$CTX-httproutes.yaml

kubectl --context="$CTX" get tcproutes.gateway.networking.k8s.io -A -o yaml \
  > cluster-$CTX-tcproutes.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ Gateway API-—Ä–µ—Å—É—Ä—Å—ã, —á—Ç–æ–±—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ –æ–Ω–∏ –ø–æ–≤–µ—Ä—Ö/–≤–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö `Gateway`/`VirtualService`.

---

## 2.2.1.6 Observability stack

–ò–º–µ–Ω–∞ namespace‚Äô–æ–≤ —É –≤–∞—Å, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –∫–∞—Å—Ç–æ–º–Ω—ã–µ. –ü–æ—ç—Ç–æ–º—É —Å–Ω–∞—á–∞–ª–∞ –ª–æ–≥–∏—á–Ω–æ ¬´–ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª –∫–ª–∞—Å—Ç–µ—Ä –ø–æ –∏–º–µ–Ω–∞–º Pod‚Äô–æ–≤.

### –ë–∞–∑–æ–≤—ã–π grep –ø–æ –≤—Å–µ–º –Ω–µ–π–º—Å–ø–µ–π—Å–∞–º

```bash
kubectl --context="$CTX" get pods -A \
  | egrep -i 'prometheus|thanos|mimir|grafana|kiali|jaeger|tempo|zipkin|loki|elastic|kibana'
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ Pods, –≤ –∏–º–µ–Ω–∞—Ö –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏. –ü–æ namespace –∏ –∏–º–µ–Ω–∏ –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —É–∂–µ —Ç–æ—á–µ—á–Ω–æ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

---

### Prometheus (–∏–ª–∏ –µ–≥–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç)

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ Prometheus –Ω–∞—à–ª–∏ –≤ namespace `monitoring`:

```bash
NS_MONITORING=monitoring

# Deployments/StatefulSets/Services
kubectl --context="$CTX" get deploy,sts,svc -n "$NS_MONITORING" \
  | grep -i prometheus

# –ü–æ–ª–Ω—ã–π YAML –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞
kubectl --context="$CTX" get deploy prometheus-server -n "$NS_MONITORING" -o yaml \
  > cluster-$CTX-prometheus-deploy.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–æ–±–∏—Ä–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ Prometheus —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç: —Ä–µ—Å—É—Ä—Å—ã, –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ–Ω—Ñ–∏–≥–∏.

Scrape-–∫–æ–Ω—Ñ–∏–≥ —á–∞—Å—Ç–æ –ª–µ–∂–∏—Ç –≤ ConfigMap:

```bash
kubectl --context="$CTX" get configmap -n "$NS_MONITORING" \
  | grep -i prometheus

kubectl --context="$CTX" get configmap prometheus-server -n "$NS_MONITORING" -o yaml \
  > cluster-$CTX-prometheus-configmap.yaml
```

---

### Grafana

```bash
kubectl --context="$CTX" get deploy,svc -A | grep -i grafana

# –ü—Ä–∏–º–µ—Ä –¥–ª—è namespace "monitoring"
kubectl --context="$CTX" get deploy grafana -n monitoring -o yaml \
  > cluster-$CTX-grafana-deploy.yaml

kubectl --context="$CTX" get configmap -n monitoring | grep -i grafana
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ Grafana –∑–∞–¥–µ–ø–ª–æ–µ–Ω–∞ –∏ –≥–¥–µ –ª–µ–∂–∞—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (datasource‚Äô—ã, dashboards, –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ ConfigMap‚Äô–æ–≤).

---

### Tracing: Jaeger / Tempo / Zipkin

```bash
kubectl --context="$CTX" get pods -A | egrep -i 'jaeger|tempo|zipkin'
```

–î–∞–ª—å—à–µ ‚Äì –∫–∞–∫ —Å Prometheus/Grafana:

```bash
kubectl --context="$CTX" get deploy -n observability jaeger -o yaml \
  > cluster-$CTX-jaeger-deploy.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–æ–π —Ç—Ä–µ–π—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –≥–¥–µ UI, –∫–∞–∫–∏–µ –ø–æ—Ä—Ç—ã/—Å–µ—Ä–≤–∏—Å—ã –∏ —Ç.–ø.

---

### –õ–æ–≥–∏: Loki / ELK

```bash
kubectl --context="$CTX" get pods -A | egrep -i 'loki|promtail|fluent-bit|fluentd|elastic|kibana|logstash'
```

–î–∞–ª—å—à–µ ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ: `get deploy/sts/svc -o yaml` –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

---

### Kiali

```bash
kubectl --context="$CTX" get pods -A | grep -i kiali
kubectl --context="$CTX" get deploy,svc -A | grep -i kiali
```

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ Kiali –≤ `istio-d`:

```bash
kubectl --context="$CTX" get deploy kiali -n istio-d -o yaml \
  > cluster-$CTX-kiali-deploy.yaml

kubectl --context="$CTX" get configmap -n istio-d | grep -i kiali
kubectl --context="$CTX" get configmap kiali -n istio-d -o yaml \
  > cluster-$CTX-kiali-configmap.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–î–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ Kiali (–∫–∞–∫ –æ–Ω –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Prometheus, Istio, –∫–∞–∫–∏–µ auth-–º–µ—Ö–∞–Ω–∏–∑–º—ã –≤–∫–ª—é—á–µ–Ω—ã).

---

## 2.2.1.7 Policy engines: Gatekeeper / Kyverno / OPA

### Gatekeeper

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ namespace
kubectl --context="$CTX" get ns | grep -i gatekeeper

# Pods –≤ gatekeeper-system
kubectl --context="$CTX" get pods -n gatekeeper-system
```

**CRD –∏ –≤–∏–¥—ã Constraint‚Äô–æ–≤:**

```bash
kubectl --context="$CTX" get crd | grep 'gatekeeper.sh'

# –ö–∞–∫–∏–µ —Ç–∏–ø—ã constrainttemplate –µ—Å—Ç—å
kubectl --context="$CTX" get constrainttemplates.templates.gatekeeper.sh -A -o yaml \
  > cluster-$CTX-gatekeeper-constrainttemplates.yaml
```

**–í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ Constraints:**

–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ kinds:

```bash
kubectl --context="$CTX" api-resources | grep 'gatekeeper.sh'
```

–ü–æ—Ç–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ kind (–Ω–∞–ø—Ä–∏–º–µ—Ä, `k8sallowedrepos`, `k8srequiredlabels` –∏ —Ç.–ø.):

```bash
kubectl --context="$CTX" get k8sallowedrepos.constraints.gatekeeper.sh -A -o yaml \
  > cluster-$CTX-gatekeeper-k8sallowedrepos.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–±—Ä–∞—Ç—å –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É –ø–æ–ª–∏—Ç–∏–∫, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Ç–µ—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ Istio-CRD (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–µ—Ç wildcard-—Ö–æ—Å—Ç–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ egress-—Ü–µ–ª–µ–π –∏ —Ç.–¥.).

---

### Kyverno

```bash
kubectl --context="$CTX" get ns | grep -i kyverno
kubectl --context="$CTX" get pods -n kyverno
```

–°–ø–∏—Å–æ–∫ –ø–æ–ª–∏—Ç–∏–∫:

```bash
# ClusterPolicy
kubectl --context="$CTX" get cpol -A -o yaml \
  > cluster-$CTX-kyverno-clusterpolicies.yaml

# Policy (namespaced)
kubectl --context="$CTX" get pol -A -o yaml \
  > cluster-$CTX-kyverno-policies.yaml
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
–°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ Kyverno. –ü–æ –Ω–∏–º –º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ Istio-–æ–±—ä–µ–∫—Ç—ã –∏ namespaces.

---

### OPA (standalone)

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∏—Å—Ç—ã–π OPA (–±–µ–∑ Gatekeeper/Kyverno), –æ–±—ã—á–Ω–æ –æ–Ω —Ç–æ–∂–µ –∂–∏–≤—ë—Ç –≤ `kube-system` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º namespace:

```bash
kubectl --context="$CTX" get pods -A | grep -i opa
```

–î–∞–ª—å—à–µ ‚Äî `get deploy -o yaml`, `get configmap -o yaml`, –∫–∞–∫ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

---

## 2.2.1.* –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë —ç—Ç–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å—ë –≤ –ø–∞–ø–∫—É `cluster-$CTX/`:

```bash
#!/usr/bin/env bash
set -euo pipefail

for CTX in "$@"; do
  OUT_DIR="cluster-$CTX"
  mkdir -p "$OUT_DIR"

  echo "=== Collecting data for context: $CTX ==="

  # Nodes
  kubectl --context="$CTX" get nodes -o wide > "$OUT_DIR/nodes.txt"

  # CoreDNS
  kubectl --context="$CTX" get configmap coredns -n kube-system -o yaml \
    > "$OUT_DIR/coredns-config.yaml" || true

  # CRDs
  kubectl --context="$CTX" get crd > "$OUT_DIR/crds.txt"

  # Gateway API
  kubectl --context="$CTX" get crd | grep gateway.networking.k8s.io \
    > "$OUT_DIR/gateway-api-crds.txt" || true

  # cert-manager
  kubectl --context="$CTX" get crd | grep cert-manager.io \
    > "$OUT_DIR/cert-manager-crds.txt" || true
  kubectl --context="$CTX" get clusterissuers.cert-manager.io -A -o yaml \
    > "$OUT_DIR/cert-manager-clusterissuers.yaml" 2>/dev/null || true

  # Gatekeeper constrainttemplates
  kubectl --context="$CTX" get constrainttemplates.templates.gatekeeper.sh -A -o yaml \
    > "$OUT_DIR/gatekeeper-constrainttemplates.yaml" 2>/dev/null || true

  # Kyverno policies
  kubectl --context="$CTX" get cpol -A -o yaml \
    > "$OUT_DIR/kyverno-clusterpolicies.yaml" 2>/dev/null || true

  # –ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä observability-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  kubectl --context="$CTX" get pods -A \
    | egrep -i 'prometheus|thanos|grafana|kiali|jaeger|tempo|zipkin|loki|elastic|kibana' \
    > "$OUT_DIR/observability-pods.txt" || true
done
```

–ó–∞–ø—É—Å–∫:

```bash
./collect-istio-deps.sh ctx-dev ctx-uat ctx-prod
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

* –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ; —Ç–æ–ª—å–∫–æ `get`.
* –°–æ–∑–¥–∞—ë—Ç –ø–æ –ø–∞–ø–∫–µ –Ω–∞ –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≥–¥–µ –ª–µ–∂–∞—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ YAML-—Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ:

  * –ø—Ä–∏–ª–æ–∂–∏—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞–∫ ‚Äú—Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é‚Äù;
  * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ baseline –¥–ª—è diff –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É –ø–æ–º–æ—á—å —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ ¬´–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—É—é¬ª –≤–µ—Ä—Å–∏—é —Å–∫—Ä–∏–ø—Ç–∞ –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –≤–∞—à naming (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ namespace‚Äô—ã monitoring/logging/istio-d/sm-gateways) –∏ —Å –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–µ–π –ª–∏—à–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ª–µ–≥—á–µ –±—ã–ª–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å compliance-—Ä–µ–≤—å—é.
